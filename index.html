<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Iron War IO - Osman</title>
    <style>
        body { margin: 0; background: #1a1a1a; overflow: hidden; touch-action: none; }
        canvas { display: block; }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const images = {
        E: {
            para: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTbV8GQtIgmRxDnqXA5kHPhYBHFeLwV72jxHS0pNPV1w&s=10",
            disli: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZQotGVQJQ-Qn2RmgAP0NyDiPQRN1uqIjyJhdM-HtD4w&s",
            kasa: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRHh9mqMQLNVAmijZA0IZCUM-YkCo0Ffv5lWSOs9SFVNA&s=10",
            jen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRGVmLe_QhENqhc0hfzIRV_MYQuPSkK9GqsRbtcGGRHKQ&s=10"
        },
        A: {
            para: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQpjNy8OW8lhUhtntVy_-jPuOBWpyLxzXb-tr5NIwpvqg&s=10",
            disli: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgefH-j_ZZP5JOOMPZoGjRRxInLmLVHvM6kovKdjYgDw&s",
            kasa: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRl4BxM22-TpThY7qwhHN3wcJ-ddm5yhJgzcrw_-_knnA&s=10",
            jen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxHYj-h1HNZYH3JnUeM-xT6Wps9LRjPrWdsLEMyk7W2g&s"
        },
        N: {
            jen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2uR5SNOE4TEVlF0BPNz770a_hsLs1wMhi2Q_eVT5l8g&s=10"
        }
    };

    const loadedImgs = {};
    for(let t in images) {
        loadedImgs[t] = {};
        for(let k in images[t]) {
            let img = new Image();
            img.src = images[t][k];
            loadedImgs[t][k] = img;
        }
    }

    let worldObjects = [];
    let myPos = { x: 5000, y: 5000 };

    socket.on('init', (data) => { worldObjects = data.objects; });

    function draw() {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const camX = myPos.x - canvas.width / 2;
        const camY = myPos.y - canvas.height / 2;

        worldObjects.forEach(obj => {
            let img = (loadedImgs[obj.tier] && loadedImgs[obj.tier][obj.kind.toLowerCase()]);
            ctx.save();
            if (img && img.complete) {
                ctx.drawImage(img, obj.x - camX, obj.y - camY, 80, 80);
            } else {
                ctx.fillStyle = obj.tier === "E" ? "#00ffff" : (obj.tier === "A" ? "#ffd700" : "#888");
                ctx.fillRect(obj.x - camX, obj.y - camY, 40, 40);
            }
            ctx.restore();
        });
        requestAnimationFrame(draw);
    }
    draw();

    // HAREKET KONTROLLERİ (PC ve MOBİL)
    const handleMove = (clientX, clientY) => {
        myPos.x += (clientX - canvas.width/2) * 0.05;
        myPos.y += (clientY - canvas.height/2) * 0.05;
    };

    window.addEventListener('mousemove', (e) => handleMove(e.clientX, e.clientY));
    window.addEventListener('touchmove', (e) => {
        handleMove(e.touches[0].clientX, e.touches[0].clientY);
        e.preventDefault();
    }, { passive: false });
</script>
</body>
</html>
